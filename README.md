
# Поисковая система
1. [x] Поиск страниц на заранее проиндексированных в многопоточном режиме веб-сайтах с учетом морфологии слов на русском и английском языке.
2. [x] Результат поиска выдается в виде постраничного списка ссылок на проиндексированные страницы веб-сайтов, отсортированных по степени релевантности относительно поискового запроса.
3. [x] Результат поиска можно получить через веб-интерфейс, либо через API.


### Используемые технологии
Java Spring Boot Framework, JPA, JSOUP, MySQL, Morphology Library Lucene


### Требования
1. Для работы поисковой системы необходимо установить:
   * Сервер баз данных MySQL, версии не ниже 8
   * Java, версии не ниже 17
2. В СУБД MySQL необходимо создать:
   * Пользователя `root` с паролем `skillbox`
   * Схему `search_engine`, указав charset/collation `utf8` и `utf8_bin` соответственно


### Запуск поисковой системы
Для запуска необходимо выполнить команду:

`java -jar SearchEngine.jar`

> Если в консоль выводятся не читаемые символы, то используйте эту команду для запуска: `java -Dfile.encoding=cp866 -jar SearchEngine.jar`

>  Исполняемый файл [SearchEngine.jar](https://github.com/Git-User-1981/diploma/raw/main/dist/SearchEngine.jar) находится в папке [dist](https://github.com/Git-User-1981/diploma/tree/main/dist) данного репозитория.


### Веб-интерфейс

Веб-интерфейс позволяет управлять процессом индексации и выполнять поиск по проиндексированным страницам веб-сайтов. 

После запуска поисковой системы веб-интерфейс доступен по адресу `http://localhost:8084/`

Веб-интерфейс содержит следующие вкладки:


#### Dashboard

Эта вкладка открывается по умолчанию. На ней
отображается общая статистика по всем веб-сайтам, а также детальная
статистика и статус по каждому из веб-сайтов.

![dashboard](https://user-images.githubusercontent.com/82952681/213454243-18fbe2be-a798-4da1-b6dd-e0453a5eb03d.png)




#### Management
На этой вкладке находятся инструменты управления
поисковой системой — запуск и остановка полной индексации
(переиндексации) страниц веб-сайтов, а также возможность добавить (обновить) отдельную
страницу по ссылке.

![management](https://user-images.githubusercontent.com/82952681/213413437-a6a833a0-3436-45d3-a135-0fb9e8d0c06c.png)



#### Search
Эта страница предназначена для выполнения поисковых запросов по проиндексированным страницам веб-сайтов.
На ней находится поле поиска, выпадающий список с выбором веб-сайта для поиска, а при нажатии на кнопку «Найти» выводятся
результаты поиска.

![search](https://user-images.githubusercontent.com/82952681/213415450-b7e89598-a483-4e12-9ae1-80c0f0074cae.png)



> Взаимодействие поисковой системы с веб-интерфейсом осуществляется посредством отправки запросов к API.




### Спецификация API

Вызов API доступен по адресу `http://172.18.2.86:8084/api`

<table>
<thead>
<tr>
<th>Назначение</th>
<th>Метод</th>
<th>URI вызова</th>
<th>Параметры вызова</th>
<th>Формат ответа в случае успеха</th>
<th>Формат ответа в случае ошибки</th>
<th>Описание</th>
</tr>
</thead>
<tbody>

<tr>
<td>Получение статистики</td>
<td align="center">GET</td>
<td>

`/statistics`
</td>
<td align="center">—</td>
<td>

```json
{
   "result": true,
   "statistics": {
      "total": {
         "sites": 12,
         "pages": 18322,
         "lemmas": 199768,
         "indexing": false
      },
      "detailed": [
         {
            "url": "https://skillbox.ru/",
            "name": "Skillbox",
            "status": "INDEXED",
            "statusTime": 1673562160790,
            "error": "Ключ не передается, если ошибок нет",
            "pages": 7919,
            "lemmas": 101556
         }
      ]
   }

}
```
</td>
<td>

```json
{
    "result": false,
    "error": "Сообщение об ошибке"
}
```
</td>
<td>Метод возвращает статистику и другую служебную информацию о состоянии поисковых индексов и самой поисковой системы</td>
</tr>

<tr>
<td>Запуск полной индексации</td>
<td align="center">GET</td>
<td>

`/startIndexing`
</td>
<td align="center">—</td>
<td>

```json
{
    "result": true
}
```
</td>
<td>

```json
{
    "result": false,
    "error": "Индексация уже запущена"
}
```
</td>
<td>Метод запускает полную индексацию всех веб-сайтов или полную переиндексацию, если они уже проиндексированы. Если в настоящий момент индексация или переиндексация уже запущена, метод возвращает соответствующее сообщение об ошибке.</td>
</tr>

<tr>
<td>Остановка текущей индексации</td>
<td align="center">GET</td>
<td>

`/stopIndexing`
</td>
<td align="center">—</td>
<td>

```json
{
   "result": true
}
```
</td>
<td>

```json
{
    "result": false,
    "error": "Индексация не запущена"
}
```
</td>
<td>Метод останавливает текущий процесс индексации (переиндексации). Если в настоящий момент индексация или переиндексация не происходит, метод возвращает соответствующее сообщение об ошибке.</td>
</tr>

<tr>
<td>Добавление или обновление индекса отдельной страницы</td>
<td align="center">POST</td>
<td>

`/indexPage`
</td>
<td>

`url` — адрес страницы, которую нужно переиндексировать
</td>
<td>

```json
{
   "result": true
}
```
</td>
<td>

```json
{
    "result": false,
    "error": "Страница не найдена"
}
```
</td>
<td>Метод добавляет в индекс или обновляет отдельную страницу, адрес которой передан в параметр.</td>
</tr>

<tr>
<td>Получение данных по поисковому запросу</td>
<td align="center">GET</td>
<td>

`/search`
</td>
<td>

`query` — поисковый запрос;

`site` — сайт (например: http://www.site.com), по которому осуществлять поиск, если не задан, поиск выполняется по всем проиндексированным веб-сайтам;

`offset` — сдвиг от 0 для постраничного вывода (необязательный; если не установлен, то значение по умолчанию равно нулю);

`limit` — количество результатов, которое необходимо вывести (необязательный; если не установлен, то значение по умолчанию равно 20);
</td>
<td>

```json
{
   "result": true,
   "count": 18,
   "data": [
      {
         "site": "https://www.site.com",
         "siteName": "Имя сайта",
         "uri": "/path/to/page/6784",
         "title": "Заголовок страницы, которую выводим",
         "snippet": "Фрагмент текста, в котором найдены совпадения",
         "relevance": 0.93362
      }
   ]
}
```
</td>
<td>

```json
{
    "result": false,
    "error": "Задан пустой запрос"
}
```
</td>
<td>Метод осуществляет поиск страниц по переданному поисковому запросу. Чтобы выводить результаты порционно, также можно задать параметры offset и limit.</td>
</tr>

</tbody>
</table>


### Логирование

В процессе работы поисковой системы выполняется логирование.
Папка с логами располагается рядом с исполняемым файлом *SearchEngine.jar* в папке `logs`.

В файле `access.log` можно просмотреть логи обращений к API.

В файле `search-engine.log` можно просмотреть логи выполнения процесса индексирования, а так же сообщения об ошибках, возникших в процессе работы поисковой системы.
